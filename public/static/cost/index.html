<html>

<head>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/global/style.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" text="text/javascript"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha/js/bootstrap.min.js"></script>
  <link type="text/css" rel="stylesheet" href="//unpkg.com/bootstrap/dist/css/bootstrap.min.css" />
  <link type="text/css" rel="stylesheet" href="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css" />
  <script src="//unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>
  <script src="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <style>
    .card{
      width: 20%;
    }
    .card-title{
      font-family: GothamRnd-Book, sans-serif;
      color: #04c6d1;
    }
    .wrapper {
      outline: 2px solid black;
      background-color: rgba(100, 100, 100, 0.2);
      align-items: stretch;
    }

    #title{
      outline: 2px solid black;
    }

    #sidebar {
      outline: 2px solid black;
        background-color: rgba(100, 100, 100, 0.2);
      min-width: 24%;
      max-width: 24%;
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="container" id="app">
    <div id="content">
      <b-tabs v-if="pricing">
        <template v-for="product in pricing">
          <b-tab :title='product.name.replace(/ +/g, "")'>
            <product-page :name='product.name.replace(/ +/g, "")' :props="product.props"></product-page>
          </b-tab>
        </template>
      </b-tabs>
    </div>
  </div>
</body>
</html>
<script>
  var app = new Vue({
    el: '#app',
    data: {
      pricing: [],
    },
    mounted: function() {
      jQuery.get('http://' + window.location.host + '/cost/pricing.json', function(data) {
        app.pricing = data;
      });
    }
  });

  Vue.component('product-page', {
    props: [
      'name',
      'props'
    ],
    data(){
      return {
        totalPrice: 0,
        prices: []
      };
    },

    methods: {
      updateTotalPrice: function(amount, index){
        this.prices[index] = amount;
        this.totalPrice = this.prices.reduce(function(total, num){return total + num}).toFixed(2);
      }
    },

    template: `
    <div class="wrapper">
        <div id="title"><h1>Total: \${{totalPrice}}</h1></div>
        <div class="card-columns p-2" id="content">
          <template v-for="(prop, index) in props">
            <property v-if="prop.inc" :name=prop.name :list=prop.list :def=prop.default :min=prop.min :max=prop.max :inc=prop.inc :index=index :unit=prop.unit v-on:inputChange="updateTotalPrice"></property>
            <property v-if="prop.steps" :name=prop.name :list=prop.list :def=prop.default :min=prop.min :max=prop.max :steps=prop.steps :index=index :unit="prop.unit" v-on:inputChange="updateTotalPrice"></property>
          </template>

        </div>

    </div>
    `
  });

  Vue.component('property', {
    props: [
      'name',
      'list',
      'def',
      'min',
      'max',
      'inc',
      'steps',
      'unit',
      'index'
    ],
    data: function() {
      return {
        price: this.def * this.list
      }
    },
    mounted: function(){
      if(this.steps) this.price = this.$refs.amount.options[0].value * this.list;

      this.$emit('inputChange', this.price, this.index);
    },
    methods: {
      updatePrice(){
        if(this.inc) this.price = this.list * this.$refs.amount.value;
        if(this.steps) this.price = parseFloat(this.$refs.amount.options[this.$refs.amount.selectedIndex].value * this.list);

        this.$emit('inputChange', this.price, this.index);
      }
    },
    template: `<div class="card">
    <div class="card-header"><h5 class="card-title m-0">{{name}}</h5></div>
    <div class="card-body">
    <input v-if="inc" ref="amount" id='input' type="number" :placeholder=def v-on:input="updatePrice()" :min=min :max=max :step=inc>

    <select v-if="steps" ref="amount" id='input' v-on:input="updatePrice()">
      <template v-for="step in steps">
        <option :value=step.val>
          {{step.name}}
        </option>
      </template></select>

    <label v-if="unit" for='input' type="number">{{unit}}</label>
    <h6 id='price'>Total: \${{price.toFixed(2)}}</h6></div></div>`
  });
</script>
